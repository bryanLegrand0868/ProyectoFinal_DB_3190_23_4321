<div class="catalogo-container">
  <div class="catalogo-content">
    <!-- Sidebar con filtros -->
    <aside class="filters-sidebar">
      <div class="filters-header">
        <h3>Filtros</h3>
        <button pButton type="button" label="Limpiar" icon="pi pi-times"
                class="p-button-text p-button-sm"
                (click)="clearFilters()"></button>
      </div>

      <!-- Filtro por categoría -->
      <div class="filter-section">
        <label class="filter-label">Categoría</label>
        <p-dropdown
          [(ngModel)]="selectedCategory"
          [options]="categories"
          optionLabel="nombre"
          optionValue="id"
          placeholder="Todas las categorías"
          [showClear]="true"
          (onChange)="onCategoryChange()"
          styleClass="w-full">
        </p-dropdown>
      </div>

      <!-- Filtro por marca -->
      <div class="filter-section">
        <label class="filter-label">Marca</label>
        <p-dropdown
          [(ngModel)]="selectedBrand"
          [options]="brands"
          optionLabel="nombre"
          optionValue="id"
          placeholder="Todas las marcas"
          [showClear]="true"
          (onChange)="onBrandChange()"
          styleClass="w-full">
        </p-dropdown>
      </div>

      <!-- Filtro por rango de precio -->
      <div class="filter-section">
        <label class="filter-label">
          Rango de Precio: Q{{ priceRange[0] }} - Q{{ priceRange[1] }}
        </label>
        <p-slider
          [(ngModel)]="priceRange"
          [range]="true"
          [min]="0"
          [max]="1000"
          [step]="10"
          (onSlideEnd)="onPriceRangeChange()">
        </p-slider>
      </div>

      <!-- Búsqueda adicional -->
      <div class="filter-section">
        <label class="filter-label">Buscar</label>
        <span class="p-input-icon-left w-full">
          <i class="pi pi-search"></i>
          <input
            type="text"
            pInputText
            [(ngModel)]="searchTerm"
            (keyup.enter)="onSearch()"
            placeholder="Buscar producto..."
            class="w-full"
          />
        </span>
      </div>
    </aside>

    <!-- Contenido principal -->
    <main class="products-main">
      <!-- Toolbar -->
      <div class="products-toolbar">
        <div class="toolbar-left">
          <h2>Productos</h2>
          <span class="product-count">
            {{ filteredProducts.length }} producto(s) encontrado(s)
          </span>
        </div>

        <div class="toolbar-right">
          <!-- Ordenamiento -->
          <p-dropdown
            [(ngModel)]="sortBy"
            [options]="sortOptions"
            optionLabel="label"
            optionValue="value"
            (onChange)="onSortChange()"
            placeholder="Ordenar por">
          </p-dropdown>

          <!-- Toggle vista -->
          <button pButton type="button"
                  [icon]="viewMode === 'grid' ? 'pi pi-list' : 'pi pi-th-large'"
                  class="p-button-outlined"
                  (click)="toggleViewMode()"
                  pTooltip="Cambiar vista"></button>
        </div>
      </div>

      <!-- Loading -->
      <div class="loading-container" *ngIf="loading">
        <p-progressSpinner></p-progressSpinner>
      </div>

      <!-- Grid de productos -->
      <div class="products-grid" [class.list-view]="viewMode === 'list'" *ngIf="!loading">
        <div class="product-card" *ngFor="let product of filteredProducts"
             (click)="viewProductDetail(product.id_producto)">
          <div class="product-image">
            <img [src]="product.imagen_url || 'assets/no-image.png'"
                 [alt]="product.nombre">
            <div class="product-overlay">
              <button pButton type="button" icon="pi pi-shopping-cart"
                      class="p-button-rounded p-button-success"
                      (click)="addToCart(product, $event)"
                      pTooltip="Agregar al carrito"></button>
            </div>
          </div>

          <div class="product-info">
            <div class="product-badges">
              <span class="badge badge-category">{{ product.nombre_categoria }}</span>
              <span class="badge badge-brand">{{ product.nombre_marca }}</span>
            </div>

            <h4 class="product-name">{{ product.nombre }}</h4>

            <p class="product-description" *ngIf="viewMode === 'list'">
              {{ product.descripcion }}
            </p>

            <div class="product-footer">
              <div class="price-container">
                <span class="product-price">Q{{ product.precio_venta | number:'1.2-2' }}</span>
              </div>

              <button pButton type="button" label="Agregar"
                      icon="pi pi-shopping-cart"
                      class="p-button-sm p-button-success"
                      (click)="addToCart(product, $event)"
                      *ngIf="viewMode === 'list'"></button>
            </div>
          </div>
        </div>
      </div>

      <!-- Sin resultados -->
      <div class="empty-state" *ngIf="!loading && filteredProducts.length === 0">
        <i class="pi pi-search"></i>
        <h3>No se encontraron productos</h3>
        <p>Intenta ajustar los filtros o buscar con otros términos</p>
        <button pButton type="button" label="Limpiar filtros"
                icon="pi pi-times"
                class="p-button-outlined"
                (click)="clearFilters()"></button>
      </div>
    </main>
  </div>

  <!-- Toast -->
  <p-toast></p-toast>
</div>
